@{
    ViewBag.Title = "Opinion";
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <meta charset="gbk">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>审批意见</title>
    <link href="~/Mobile/css/style.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/Mobile/css/weui.css">
</head>

<body class="gray-page">
    <form>
        <div class="approval-opinion weui-cells">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <label class="weui-label text-is-center">审批信息:</label>
                    <textarea class="weui-input remark"></textarea>
                </div>
            </div>
            <p class="opinion-speedy">
                快捷意见输入:
                <a class="font-color-green" href="javascript:;">同意</a>
                <a class="font-color-red" href="javascript:;">不同意</a>
                <a class="font-color-green" href="javascript:;">已办理</a>
                <a class="font-color-orange" href="javascript:;">已阅</a>
            </p>
        </div>
        <div class="weui-cell chose-button">
            <button type="button" class="weui-btn weui-btn_primary">下一步</button>
        </div>
    </form>
    <script src="~/Scripts/zepto.min.js"></script>
    <script type="text/javascript" src="https://g.alicdn.com/dingding/open-develop/1.6.9/dingtalk.js"></script>
    <script src="~/DDStatic/js/fastclick.js"></script>
    <script src="~/DDStatic/js/index.js"></script>
    <script>
        $(".opinion-speedy a").bind("click", function () {
            $("textarea").val($(this).text() + $("textarea").val());
        });

        $("button").bind("click", function () {
            $(window.parent.document).find("#opinion").val($("textarea").val());
            var optType = window.Util.getQuery("OptionType");
            if (optType) {
                var runParameter = { IsSimulate: '0', Command: optType, InstanceId: window.parent.Util.getQuery("InstanceId"), ItemId: window.parent.Util.getQuery("ItemId"), OpinionContent: $("textarea").val(), OpinionArea: 0, UserChoice: [] };
                RunCommand('/Workflow/ExecCommand', runParameter);
            }
            else {
                window.location = "/Mobile/NextStep?InstanceId=" + window.parent.Util.getQuery("InstanceId") + "&ItemId=" + window.parent.Util.getQuery("ItemId");
            }
        })


        function RunCommand(url, data) {
            $.ajax({
                url: url,
                data: data,
                type: 'POST',
                dataType: "json",
                success: function (data, status, xhr) {
                    if (data) {
                        //var err = data.Result ? "操作成功" : data.ErrorMessage;
                        
                        if (data.Result == true) {
                            location = "/Mobile/WorkflowSuccess";
                        }
                        else
                        {
                            dd.device.notification.alert({
                                message: data.ErrorMessage,
                                title: "提示",
                                buttonName: "确认",
                                onSuccess: function () { },
                                onFail: function (err) { }
                            });
                        }
                    }
                },
                error: function (xhr, errorType, error) {
                    logger.e(errorType + "," + error);
                    alert("操作出错");
                }

            });
        }
    </script>
</body>

</html>