@using FoxOne.Business.Security;
<html>
<head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <meta charset="gbk">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>发送弹幕</title>
    <link href="~/Mobile/css/style.css" rel="stylesheet" />
    <style>
        .contain {
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="contain">
            <img src="/images/party/bg.png" width="100%" height="100%" />
        <div style="position:absolute;top:0;left:10px;right:10px; padding-top:10px;">
            <form method="post" action="/api/Party/Message">
                <input type="hidden" name="userId" value="@Sec.User.Id"/>
                <textarea id="message" style="width:100%;height:300px;border-width:0px;font-size:14px;padding:10px;line-height:20px;" placeholder="输入弹幕"></textarea>
                <img id="btnSend" style="margin-top:10px;" src="~/images/party/btn_send.png" width="100%" />
            </form>
        </div>
    </div>
    <script src="~/Scripts/zepto.min.js"></script>
    <script type="text/javascript" src="https://g.alicdn.com/dingding/open-develop/1.6.9/dingtalk.js"></script>
    <script src="~/DDStatic/js/fastclick.js"></script>
    <script src="~/DDStatic/js/index.js"></script>
    <script>
        dd.ready(function () {
            dd.biz.navigation.setRight({
                text: "",
                onSuccess: function (data) {
                },
                onFail: function (err) {
                    logger.e(JSON.stringify(err));
                }
            });


        });

        $("#btnSend").bind("click", function () {
            var str = $("#message").val();
            if (!str || str.toString().length == 0) {
                alert('请输入弹幕内容');
                return;
            }
            if (str.length > 30)
            {
                alert("弹幕内容过长，请控制在30个字以内");
                return;
            }
            if ($(this).attr("enable") != null) return;
            $(this).attr("enable", "enable");
            $.ajax({
                url: '/api/Party/Message',
                //async: true,
                //dataType: 'json',
                type: 'post',
                data: { UserName: '@Sec.User.Name', Message: str, DepartmentName:'@Sec.User.Department.Name' },
                success: function (data, status, xhr) {
                    var info = JSON.parse(data);
                    if (info.Result == true)
                    {
                        alert("发送成功");
                        $("#message").val("");
                    }
                    else {
                        alert("发送失败");
                    }
                    $("#btnSend").removeAttr("enable");
                },
                fail: function () {
                    $("#btnSend").removeAttr("enable");
                }
            });
        });
    </script>
</body>
</html>
