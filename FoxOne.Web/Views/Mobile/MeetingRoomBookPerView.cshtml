@model System.Collections.Generic.List<FoxOne.Web.Controllers.MeetingRoomBookInfoView>
@{
    Layout = null;
}
@using FoxOne.Business
@using FoxOne.Controls
@using FoxOne.Core
@using FoxOne.Business.Environment

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <meta charset="gbk">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>会议室预订情况一览</title>    
    <!--dd_nav_bgcolor-->
    <link href="~/Mobile/css/style.css" rel="stylesheet" />
    <link href="~/DDStatic/css/reset.css" rel="stylesheet" />
    <link href="~/DDStatic/css/task.css" rel="stylesheet" />
</head>
<body>
    <div class="dateline">
        <a href="javascript:;" class="prev">
            <i class="iconfont prev_arrow">&#xe76e;</i>
            <span>前一天</span>
        </a>
        <input type="text" class="datebox datepicker" readonly="readonly" value="@Model[0].TimePoint.ToString("yyyy-MM-dd")" />
        <a href="javascript:;" class="next">
            <span>后一天</span>
            <i class="iconfont next_arrow">&#xe76d;</i>
        </a>
    </div>
    @foreach (FoxOne.Web.Controllers.MeetingRoomBookInfoView room in Model)
    {
        <div class="reservation_info">
            <p class="info_title">@room.Name</p>
            <a href="javascript:;">
                @foreach (var detail in room.BookInfoDetail)
                {
                <div class="meeting reserved clickable" bookId="@detail.BookId">
                    <p>@detail.UserAndTime</p>
                    <p>@detail.Title</p>
                </div>
                }
            </a>
            <a href="javascript:;" ><div class="meeting unreserved clickable" room="@room.Code">点击预订</div></a>
        </div>
    }


    <script src="~/Scripts/zepto.min.js"></script>
    <script type="text/javascript" src="https://g.alicdn.com/dingding/open-develop/1.6.9/dingtalk.js"></script>
    <script src="~/DDStatic/js/fastclick.js"></script>
    <script src="~/DDStatic/js/index.js"></script>
    <script>
        var logger = { i: function (info) { }, e: function (err) { dd.device.notification.alert({ message: err, title: '异常提示', buttonName: '关闭' }) } };



        dd.ready(function () {


            dd.biz.navigation.setRight({
                text: '@FoxOne.Business.Security.Sec.User.Name',
                onSuccess: function (data) {
                },
                onFail: function (err) {
                    logger.e(JSON.stringify(err));
                }
            });

            //绑定每个任务的点击事件，事件采用代理的方式
            $(document).on('click', '.clickable', function () {
                var _this = $(this);
                _this.addClass('active');
                setTimeout(function () {
                    _this.removeClass('active');
                }, 100);

                //查看预定
                if (_this.attr("bookId") != null&&  _this.attr("bookId") != "") {
                    location = Util.getTargetUrl("MeetingRoomBookPerView", "MeetingRoomBook?_form_view_mode=view&@NamingCenter.PARAM_KEY_NAME=" + _this.attr("bookId"));
                    //Page.go2URL(Util.getTargetUrl("MeetingRoomBookPerView", "MeetingRoomBook?_form_view_mode=view&_form_key=" + _this.attr("bookId")));
                }
                else //添加预定
                {
                    location = Util.getTargetUrl("MeetingRoomBookPerView", "MeetingRoomBook?MeetingRoomId=" + _this.attr("room"));
                    //Page.go2URL(Util.getTargetUrl("MeetingRoomBookPerView", "MeetingRoomBook?MeetingRoomId=" + _this.attr("room")));
                }
            });

            $('.datepicker').on('click', function () {
                var node = $(this);
                var v = node.val();
                dd.biz.util.datepicker({
                    format: 'yyyy-MM-dd',
                    value: v,
                    onSuccess: function (result) {
                        node.val(result.value);
                        location = '/Mobile/MeetingRoomBookPerView?tp=' + result.value;
                    },
                    onFail: function () { }
                });
            });

            $(".prev").bind("click", function () {
                location = '/Mobile/MeetingRoomBookPerView?tp=@Model[0].TimePoint.AddDays(-1).ToString("yyyy-MM-dd")';
            });
            $(".next").bind("click", function () {
                location = '/Mobile/MeetingRoomBookPerView?tp=@Model[0].TimePoint.AddDays(1).ToString("yyyy-MM-dd")';
            });

            Page.defaultBackEvent();

        });



        dd.error(function (err) {
            logger.e('dd error: ' + JSON.stringify(err));
        });
    </script>
</body>
</html>
